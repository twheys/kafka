


var adsafeVisParams = {
	mode : "jss",
	jsref : "http://bravenewmethod.wordpress.com/2010/12/02/simple-reverse-geocoding-with-couchdb/",
	adsafeSrc : "http://fw.adsafeprotected.com/rfw/video.unrulymedia.com/12952/396574/wildfire_73165225.js",
	adsafeSep : "?",
	requrl : "",
	reqquery : "",
	debug : "false",
	allowEnagement : "true",
	trackMouse : "true",
	
	jsFeatures : "",
	enagementDelay : "1-5-15",
	useAdTalk : "true",
	adTalkDtCall : "true",
	killPhrases : "",
	asid : "da2e9702-7143-11e2-95b1-0025903700d2",
	adWidth : "-1",
	adHeight : "-1"
};


(function(az,g){var C="3.4.0";var ak={list:{},codes:{GET_AD_DIMENSIONS:"a",ADTALK_GENERAL:"c",GET_SCREEN_LOC_GET_DIMENSIONS:"d",PHONE_HOME:"h",KILL_IT:"k",LOCATION_DETAILS:"l",GET_SCREEN_LOC_PIV_CALC:"p",GET_WIN_DIMENSIONS:"w",ADTALK_DUBIOUS:"D"},add:function(e){if(typeof this.list[e]!=F){this.list[e]++;}else{this.list[e]=1;}},toString:function(){var aI="";for(var e in this.list){if(this.list.hasOwnProperty(e)){aI+=e;}}return aI;},hasErrors:function(){for(var e in this.list){return true;}return false;}};var r=(az.debug==="true");var F="undefined";var ah=2000;var aA;var Q=window!==top;var l=false;try{l=typeof top.innerHeight!==F&&typeof top.innerHeight!=="unknown";}catch(L){l=false;}var t=false;var z=new Date().getTime();var an={};var f=function(e){return az.jsFeatures.indexOf(e)!==-1;};var j=function(){var aM=function(){};var aL=function(aO){top.postMessage(aO,"*");};var aK,aN,aJ=false,aI="pm,inDoc,";var e=aI+"log,info,warn,dir,exception,trace,group,groupEnd,groupCollapsed,profile,profileEnd,count,clear,time,timeEnd,timeStamp,table,error,memoryProfile,memoryProfileEnd";e=e.split(",");if(typeof console!==F&&r){an=console;for(aK=0,len=e.length;aK<len;aK++){aN=e[aK];if(typeof an[aN]===F){if(typeof an.log===F){an[aN]=aM;}else{an[aN]=an.log;}}}an.pm=window.postMessage?aL:aM;an.inDoc=function(aQ,aP){var aO=function(){var aR;try{if(!aJ){aJ=document.createElement("ul");document.body.appendChild(aJ);}aR=document.createElement("li");aJ.appendChild(aR);aR.textContent=aQ;}catch(aS){}};if(!aP){aO();}else{setTimeout(aO,aP);}};}else{for(aK=0,len=e.length;aK<len;aK++){aN=e[aK];an[aN]=aM;}}};j();an.info("v"+C+", mode: "+az.mode);an.groupCollapsed("Server Parameters");an.dir(az);an.groupEnd();var N=function(aJ,aK,aI,e){if(typeof aJ.addEventListener!=F){if(aK==="mouseenter"){aJ.addEventListener("mouseover",al(aI),e);}else{if(aK==="mouseleave"){aJ.addEventListener("mouseout",al(aI),e);}else{aJ.addEventListener(aK,aI,e);}}}else{if(typeof aJ.attachEvent!=F){aJ.attachEvent("on"+aK,aI);}}};var T=function(aI,aJ,e){if(typeof aI.removeEventListener!=F){if(aJ==="mouseenter"){aJ="mouseover";e=al;}else{if(aJ==="mouseleave"){aJ="mouseout";e=al;}}aI.removeEventListner(aJ,e);}else{if(typeof aI.detachEvent!=F){aI.detachEvent("on"+aJ,e);}}};var al=function(e){return function(aI){var aJ=aI.relatedTarget;if(this===aJ||aa(this,aJ)){return;}e.call(this,aI);};};var aa=function(e,aI){if(e===aI){return false;}while(aI&&aI!==e){aI=aI.parentNode;}return aI===e;};var u=function(aI,e){var aJ=""+aI;while(aJ.length<e){aJ="0"+aJ;}return aJ;};var U=function(aL,aK){var aI="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");var aJ,e=[];do{aJ=aL%aK;e.push(aI[aJ]);aL=(aL-aJ)/aK;}while(aL>0);return e.reverse().join("");};var aC=(function(){var aJ=new Date();var aI=Date.parse("Jan 1 "+aJ.getFullYear());var e=aJ.getTime()-aI;return U(e,62);}());var m=function(){var aL=0,aJ={};var aI=function(aN,aO,aM){if(typeof aN.output==="undefined"){throw new Error("item with id "+aO+' must have "output" method');}this.item=aN;this.id=aO||++aL;this.props=aM||{};this.output=function(){return(typeof aN.output==="function")?aN.output():aN.output;};};var e=function(aO){var aP,aM,aN=[];for(aP in aJ){if(aJ.hasOwnProperty(aP)){aM=aO(aP,aJ[aP]);if(aM){aN.push(aM);}}}return aN;};var aK=function(aO,aP,aN){var aM=new aI(aO,aP,aN||{});aJ[aM.id]=aM;};return{addItem:aK,iterate:e,getItem:function(aM){return aJ[aM];}};};m=new m();var at;var aj=function(){var aQ=function(aT){var aS={a:"top.location.href",b:"parent.location.href",c:"parent.document.referrer",d:"window.location.href",e:"window.document.referrer",f:"jsref",g:"ffCheck -- firefox result",q:"ffCheck -- parent.parent.parent... result"};an.groupCollapsed("Detection Results");var aU="";for(var e in aT){row=aT[e];aU+=row.key+": "+decodeURIComponent(row.val)+"\n";}an.log(aU);an.dir(aS);an.groupEnd();};var aN=function(){var aS={g:"",q:""};try{aS.q=window.parent.parent.parent.parent.parent.parent.parent.parent.parent.parent.location.href;}catch(aU){var aT=aU.message;var aV=aT.substring(aT.lastIndexOf("<")+1,aT.lastIndexOf(">"));if(typeof aV!=F&&aR()){aS.g=aV;}}return aS;};var aR=function(){var aT=3;var aS=6;var aW=13;var a1=false;if(typeof window.navigator!==F&&typeof window.navigator.userAgent!==undefined){var aU=window.navigator.userAgent;var e=window.navigator.userAgent.match(/Firefox\/([\.0-9]+)/);if(e!==null&&e.length==2){var aY=e[1];var aV=aY.split(".");var aZ=aV[0];if(parseInt(aZ,10)==aT){var aX=aV[1];if(parseInt(aX,10)<=aS){if(aV.length==3){var a0=aV[2];if(parseInt(a0,10)<=aW){a1=true;}}else{a1=true;}}}}}return a1;};var aJ=function(e){for(var aT in e){if(e.hasOwnProperty(aT)){var aS=e[aT];if(aS===""||aS==="null"||aS===F||aS===null||typeof aS===F){delete e[aT];}}}return e;};var aP=function(aT){var e={};var aU,aV;for(aV in aT){if(aT.hasOwnProperty(aV)){aU=aT[aV];if(typeof e[aU]==F){e[aU]=aV;}else{e[aU]+=aV;}}}var aS={};for(aV in e){if(e.hasOwnProperty(aV)){aU=e[aV];aS[aU]=aV;}}return aS;};var aL={};try{aL.a=encodeURIComponent(top.location.href);}catch(aO){}try{aL.b=encodeURIComponent(parent.location.href);}catch(aO){}if(Q){try{aL.c=encodeURIComponent(parent.document.referrer);}catch(aO){}try{aL.e=encodeURIComponent(window.document.referrer);}catch(aO){}}try{aL.d=encodeURIComponent(window.location.href);}catch(aO){}try{aL.f=encodeURIComponent(az.jsref);}catch(aO){}try{var aK=aN();aL.g=encodeURIComponent(aK.g);aL.q=encodeURIComponent(aK.q);}catch(aO){}aL=aJ(aL);aL=aP(aL);var aM=[];for(var aI in aL){if(aL.hasOwnProperty(aI)){aM.push({key:aI,val:aL[aI]});}}aM.sort(function(aS,e){return(aS.val.length>e.val.length)?1:(aS.val.length<e.val.length)?-1:0;});aQ(aM);return aM;};var A=document.getElementsByTagName("script");var ao=A[A.length-1];var aG=ao.parentNode;var D=null;var aE=false;var ai={SPAN:"s",AD_HUNT:"a",IFRAME:"i"};var k={LOCATION:"l",OBSTRUCTION:"o",FOCUS:"f"};var x=function(){var aQ,aU,aR,aO;var aT=D;if(az.mode=="jsli"){return{viewState:"na",embedded:Q};}try{aQ=am();aU=getAdDimensions();if(aQ===-1||aU===-1){return{viewState:"na",embedded:Q};}else{var aM=Y(aQ.x,aQ.x+aQ.width,aU.x,aU.x+aU.width);var aK=Y(aQ.y,aQ.y+aQ.height,aU.y,aU.y+aU.height);var aN=(aM<=0||aU.width<=0)?0:Math.round(aM/aU.width*100);var aL=(aK<=0||aU.width<=0)?0:Math.round(aK/aU.height*100);aR=Math.round(aN*aL/100);}}catch(aS){ak.add(ak.codes.GET_SCREEN_LOC_GET_DIMENSIONS);an.trace();an.error(aS);}try{if(typeof window.mozInnerScreenY==F&&typeof window.screenY!=F&&aU.y==aQ.y){aO="na";}else{if(aR>=75){aO="inView";}else{if(aR<=25){aO="outOfView";}else{if(aR>=50){aO="partialViewPlus";}else{aO="partialViewMinus";}}}}}catch(aS){ak.add(ak.codes.GET_SCREEN_LOC_PIV_CALC);an.error(aS);}var aJ=[];if(aO=="outOfView"){aJ.push(k.LOCATION);}var aI=R(aU);if(aI===true){aO="outOfView";aJ.push(k.OBSTRUCTION);aI=1;}else{if(aI===false){aI=0;}else{aI="na";}}var aP=G();if(aP===true){aO="outOfView";aJ.push(k.FOCUS);aP=1;}else{if(aP===false){aP=0;}else{aP="na";}}if(D&&aT!==D){an.log("New Engagement Node:",D);}return{winDimensions:aQ,adDimensions:aU,viewState:aO,percentInView:aR,reason:aJ.join("."),obstructed:aI,tabHidden:aP};};var am=function(){var aJ,aN,aK,aL;try{if(l){aJ=aN=0;if(typeof top.document.documentElement.clientWidth!=F){aK=top.document.documentElement.clientWidth;}if(typeof top.document.documentElement.clientHeight!=F){aL=top.document.documentElement.clientHeight;}}else{if(typeof window.screenX!=F){aJ=window.screenX;}if(typeof window.screenY!=F){aN=window.screenY;}if(typeof window.outerWidth!=F){aK=window.outerWidth;}if(typeof window.outerHeight!=F){aL=window.outerHeight;}}}catch(aM){ak.add(ak.codes.GET_WIN_DIMENSIONS);an.exception(aM);}var aI;if(isNaN(aJ)||isNaN(aN)||isNaN(aK)||isNaN(aL)){aI=-1;}else{aI={x:Math.round(aJ),y:Math.round(aN),width:Math.round(aK),height:Math.round(aL)};}return aI;};getAdDimensions=function(){var aN,aM,aQ,aJ,aI,aO;if(typeof aG.getBoundingClientRect!=F){aO=aG.getBoundingClientRect();var aL={};aL.x=Math.round(aO.left);aL.y=Math.round(aO.top);aL.width=Math.round(aO.right-aO.left);aL.height=Math.round(aO.bottom-aO.top);aO=aL;}if(Q){aI=ai.IFRAME;try{if(l){var aP=af(window);aN=aP.left;aM=aP.top;}else{if(typeof window.mozInnerScreenX==F){aN=window.screenLeft;aM=window.screenTop;}else{aN=Math.round(window.mozInnerScreenX);aM=Math.round(window.mozInnerScreenY);}}if(typeof(window.innerWidth)!=F){aQ=window.innerWidth;}if(typeof(window.innerHeight)!=F){aJ=window.innerHeight;}}catch(aK){ak.add(ak.codes.GET_AD_DIMENSIONS);an.exception(aK);}}else{if(!aE){var aS=E(aG);if(aq(aS)>1){D=aS;aI=ai.AD_HUNT;aE=true;}else{aI=ai.SPAN;}}else{aI=ai.AD_HUNT;}if(!D){D=document.createElement("span");D.style.width="0px";D.style.height="0px";D.style.display="block";D.style.overflow="hidden";D.style.visibility="hidden";D.innerHTML=".";aG.insertBefore(D,ao.nextSibling);}var aR=D.getBoundingClientRect();aN=aR.left;aM=aR.top;aQ=(aR.width)?aR.width:1;aJ=(aR.height)?aR.height:1;}var aT;if(isNaN(aN)||isNaN(aM)||isNaN(aQ)||isNaN(aJ)){aT=-1;}else{aT={x:Math.round(aN),y:Math.round(aM),width:Math.round(aQ),height:Math.round(aJ),method:aI,container:aO};}return aT;};var E=function(aQ){var aS="iframe,img,a,object,embed,div".split(",");var aN=[];var aO,aI=-1;var aM;for(aM=0,len=aS.length;aM<len;aM++){var aJ=aS[aM];var aP=aQ.getElementsByTagName(aJ);if(aP.length){for(var aL=0,e=aP.length;aL<e;aL++){aN.push(aP[aL]);}}}if(aN.length){for(aM=0,len=aN.length;aM<len;aM++){var aR=aN[aM];var aK=aq(aR);if(aK>aI){aO=aR;aI=aK;}}}if(typeof aO==F){return null;}else{if(typeof aO.nodeName!=F&&aO.nodeName=="DIV"){return E(aO);}else{return aO;}}};var aq=function(aJ){var aI=-1;if(aJ){var e=aJ.getBoundingClientRect();aI=e.width*e.height;}return aI;};var af=function(aL,aO){if(typeof aO===F){aO={top:0,left:0};}var aN=aL.parent.document.getElementsByTagName("iframe");var aM;var aK=false;for(var aI=0,e=aN.length;aI<e;aI++){aM=aN[aI];if(aM.contentWindow==aL){aK=true;break;}}if(aK){var aJ=aM.getBoundingClientRect();aO.left+=aJ.left;aO.top+=aJ.top;if(aL!==top){af(aL.parent,aO);}}return aO;};var R=function(aK){var e=null;if(aE&&!Q&&D&&aK&&typeof document.elementFromPoint!=F){var aJ=Math.floor(aK.x+(aK.width/2));var aI=Math.floor(aK.y+(aK.height/2));var aL=document.elementFromPoint(aJ,aI);if(aL!==null){e=aL!==D;}}return e;};var G=function(){var e=null;if(typeof document.hidden!=F){e=document.hidden;}else{if(typeof document.mozHidden!=F){e=document.mozHidden;}else{if(typeof document.msHidden!=F){e=document.msHidden;}else{if(typeof document.webkitHidden!=F){e=document.webkitHidden;}}}}return e;};var Y=function(aI,e,aK,aJ){return Math.min(e,aJ)-Math.max(aK,aI);};var a={UNLOAD:"u",PING:"p",LOCATION_CHANGE:"sl",ADTALK:"a"};var ag;var i;var aF=[];var au=false;var w=250;var aD=1000;var M=(az.enagementDelay.indexOf("-")!==-1)?az.enagementDelay.split("-"):[az.enagementDelay];var I=0;var aH,s;var aB=function(){aH=M[I];s=aH*aD/w;};aB();an.groupCollapsed("Engagement Settings");an.log("pingTimes:",M,"pingNum:",I,"pingTime:",aH,"pingThreshold:",s,"engagementCodes:",a);an.groupEnd();var ac=0;var ar=false;var V=function(aK,aP){an.group("Send "+aP+"-type DT Call");var aM="";if(t&&(aP===a.ADTALK||ag!=="na")){var aQ=o();if(typeof aP==F){aP=a.UNLOAD;}if(aP===a.UNLOAD&&au){return;}try{if(az.mode=="jspix"||az.mode=="jload"){aM=az.requrl;}else{var aT=az.adsafeSrc.indexOf("/",9);aM=az.adsafeSrc.substr(0,aT)+"/";}var aU=K();var aR="asId="+az.asid;var e=aH;if(aP===a.UNLOAD){e=-1;}else{if(aP===a.ADTALK){e=-2;}}var aL=(c.time!==-1)?",hoverTime:"+c.time+",mouseBox:"+c.getBoundingBoxString():"";var aO=(ak.hasErrors())?",e:"+ak.toString():"";var aJ="";m.iterate(function(aW,aV){if(!aV.props.type||aV.props.type===aP){aJ+=","+aW+":"+aV.output();an.pm(aW+" call: "+aV.output());}});var aS="&tv={c:"+aC+",pingTime:"+e+",time:"+aQ+",type:"+aP+aU+aL+aO+aJ+"}";var aI=aM+"dt?"+aR+aS;aI+="&adsafePrivacyPolicy=http://adsafemedia.com/privacy-policy";an.info("Sending "+aP+"-type dt data to: "+aI);W(aI);if(aP===a.UNLOAD){au=true;}}catch(aN){ak.add(ak.codes.PHONE_HOME);an.error(aN);}}an.groupEnd();};var B=function(){var aI={inView:0,outOfView:0,partialViewPlus:0,partialViewMinus:0};var aL,aN,aJ,aM=0;for(var aK=0,e=aF.length;aK<e;aK++){aL=(aK===0)?i:aF[aK-1].sl;aN=aF[aK].t;aI[aL]+=aN-aM;aM=aN;}aN=o();aJ=(e===0)?aN:aN-aF[e-1].t;aI[ag]+=aJ;return aI;};var K=function(){var aI=B();var aJ=10;var e="";if(aF.length){e=",slTimes:{i:"+aI.inView+",o:"+aI.outOfView+",pp:"+aI.partialViewPlus+",pm:"+aI.partialViewMinus+"}";e+=",slEvents:["+aF.slice(-aJ).join(",")+"]";e+=",slEventCount:"+aF.length;an.groupCollapsed("Engagement Events");an.dir(aI);an.dir(aF);an.groupEnd();}else{an.info("No events.");}return e;};var p=function(aJ){var aK=(typeof aJ==F)?o():aJ;var aI=aF.length;var e=(aI===0)?aK:aK-aF[aI-1].t;return e;};var P=function(aI,aP,aO){var e;var aK=function(aQ,aR){return'<param name="'+aQ+'" value="'+aR+'"/>';};var aL=function(){var aT,aX=az.adsafeSrc.indexOf("/",9),aR=az.adsafeSrc.substr(0,aX),aY=aR.split("//")[0]+"//",aQ=aR.split("."),aU=aQ.shift(),aS="static."+aQ.join("."),aZ=aY+aS+"/detector.pix",aW=aK("allowscriptaccess","always"),aV=aK("movie",az.cocaPuffsPath||aZ)+aK("play","true")+aK("loop","true");if(h.getBrowser()==="i"){aT=document.createElement("div");aT.innerHTML='<object id="blag" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000">'+aV+aW+"</object>";e=aT.firstChild;}else{e=document.createElement("object");e.data=az.cocaPuffsPath||aZ;e.type="application/x-shockwave-flash";e.innerHTML=aW;}e.style.position="absolute";e.style.width="1px";e.style.opacity="0";e.style.height="1px";return e;};var aJ=function(aR,aQ,aT){var aS=aL();aS.style.left=aQ;aS.style.top=aT;aR.appendChild(aS);};var aM=function(){return aN()&&e.isInView();};var aN=function(){return e&&typeof e.isInView==="function";};aJ(aI,aP,aO);return{isInView:aM,isNotReadyToReport:function(){return !aN();}};};var ay=function(aK,e){var aI=new aK(document.body,window.innerWidth/2,window.innerHeight/2);var aJ=function(){var aM=aI.isInView();var aL=aM?"inView":"outOfView";var aN=aM?100:0;return{str:aI.isNotReadyToReport()?"na":aL,pct:aI.isNotReadyToReport()?-1:aN};};return{checkViewable:aJ};};var ad;var ap=function(){var aI;newScreenLocInfo=x();if(f("cocoapuffs")&&h.getBrowser()!=="g"&&Q){ad=ad||new ay(P,aG)||{};aI=ad.checkViewable();newScreenLocInfo.viewState=aI.str;newScreenLocInfo.percentInView=aI.pct;}newScreenLoc=newScreenLocInfo.viewState;if(ag!=newScreenLoc){an.info("New location: "+newScreenLoc);var e=H(newScreenLocInfo,ag);aF.push(e);ag=newScreenLoc;an.pm("percentInView:"+newScreenLocInfo.percentInView+",viewState:"+ag+K());}if(ag==="inView"||ag==="partialViewPlus"){ac++;}if(ac>s&&!ar){V(null,a.PING);I++;if(I<M.length){aB();}else{ar=true;}}};var H=function(aI,e){var aK=o();var aJ={t:aK,sl:aI.viewState,details:ax(aI)};aJ.toString=function(){return"{t:"+this.t+",sl:"+this.sl+this.details+"}";};an.log("creating event: "+aJ);return aJ;};var o=function(){return new Date().getTime()-z;};var aw=function(){var e=false;if((az.allowEnagement==="true")&&typeof document.addEventListener=="function"){aA=false;if(document.readyState=="complete"||document.readySate=="loaded"){O();}else{document.addEventListener("DOMContentLoaded",O,false);}}};var O=function(e){an.info("Page ready.");aA=true;if(t){i=ag;an.pm(i);setInterval(ap,w);if(typeof window.addEventListener=="function"){an.info("Adding beforeunload event.");window.addEventListener("beforeunload",V,false);}}};var h={browserCodes:{UNKNOWN:"u",OPERA:"o",GECKO:"g",CHROME:"c",SAFARI:"s",WEBKIT:"w",IE:"i"},getBrowser:function(){var e;if(typeof window.opera!==F&&typeof window.opera.buildNumber!==F){e=this.browserCodes.OPERA;}else{if(typeof window.mozInnerScreenY!==F){e=this.browserCodes.GECKO;}else{if(typeof window.chrome!==F&&typeof window.chrome.app!==F){e=this.browserCodes.CHROME;}else{if(typeof window.WebKitPoint!==F){e=this.browserCodes.WEBKIT;}else{if(typeof window.attachEvent!==F){e=this.browserCodes.IE;}else{e=this.browserCodes.UNKNOWN;}}}}}return e;}};var c={time:-1,enterTime:null,min:null,max:null,trackMaxMin:null,mouseLeave:function(aI){var e=new Date().getTime()-c.enterTime;c.time+=e;T("mousemove",c.move);an.log("mouseLeave - time:",e,c.time,"bounding box:",c.getBoundingBoxString(),aI);},mouseEnter:function(e){an.log("mouseEnter",e);if(c.time===-1){c.time=0;}c.enterTime=new Date().getTime();N(window,"mousemove",c.move);},getBoundingBoxString:function(){var e;if(c.min&&c.max){e=c.min.x+"-"+c.min.y+"-"+c.max.x+"-"+c.max.y;}else{e="-1";}return e;},move:function(e){if(c.trackMaxMin===null){c.trackMaxMin=c.min&&c.max&&typeof e.clientX!=F&&typeof e.clientY!=F;}if(c.trackMaxMin){if(e.clientX<c.min.x){c.min.x=e.clientX;}if(e.clientY<c.min.y){c.min.y=e.clientY;}if(e.clientX>c.max.x){c.max.x=e.clientX;}if(e.clientY>c.max.y){c.max.y=e.clientY;}}},init:function(){if(f("mousetrack")||az.trackMouse==="true"){if(Q){N(window,"mouseenter",this.mouseEnter);N(window,"mouseleave",this.mouseLeave);if(typeof(window.innerWidth)!=F&&typeof(window.innerHeight)!=F){this.min={x:window.innerWidth,y:window.innerHeight};this.max={x:0,y:0};}}}}};var v=function(aK){var aL,aJ,e;switch(az.mode){case"jss":aL='<script type="text/javascript"';e="<\/script>";break;case"jsi":aL='<iframe width="100%" height="100%" frameborder="0" vspace="0" hspace="0" scrolling="no" marginheight="0" marginwidth="0"';e="</iframe>";break;}var aI=X(aK);aI+=Z(aI.length,false);aJ=' src="'+aI+'">';an.info("writeOut: "+aL+aJ+e);document.write(aL+aJ+e);};var X=function(aI){an.groupCollapsed("getFWUrl");var e=az.adsafeSrc;e+=az.adsafeSep;an.log("base url: "+e);an.log("length: "+e.length);an.group("Getting urls and types:");e+=n(aI,e.length);an.groupEnd();an.info("final: "+e);an.log("length: "+e.length);an.groupEnd();return e;};var n=function(aJ,aN){an.groupCollapsed("Get URLs & Types");an.log("lengthSoFar: "+aN);if(aN>=ah){return"";}var aI="";var aQ=aJ.length;var aR="adsafe_url=";var aO="&adsafe_type=";var aP=aR.length+aO.length;var aM,aS;var e=false;for(aM=0;aM<aQ;aM++){aS=aJ[aM];if(aS.key.indexOf("q")!=-1){an.log("found q");if(aI.length+aN+aP+aS.val.length+aS.key.length+1<=ah){an.log("adding it");aI+=ab(aS,"");e=true;}else{an.log("but did not add it");}}else{if(aS.key.indexOf("g")!=-1){an.log("found g");if(aI.length+aN+aP+aS.val.length+aS.key.length+1<=ah){an.log("adding it");aI+=ab(aS,"");e=true;}else{an.log("but did not add it");}}}}for(aM=0;aM<aQ;aM++){aS=aJ[aM];if(aS.key.indexOf("g")===-1&&aS.key.indexOf("q")===-1){if(aI.length+aN+aP+aS.val.length+aS.key.length+1<=ah){var aL=(e)?1:aM;var aK=(aL>0)?"&":"";an.log("adding "+aS.key);aI+=ab(aS,aK);}else{an.log("skipping "+aS.key);}}}an.groupEnd();return aI;};var ab=function(e,aJ){var aI=aJ+"adsafe_url="+e.val;aI+="&adsafe_type="+e.key;an.log("- "+aI);return aI;};var y=function(aK){var aI=az.requrl;if(az.reqquery.length>0){aI+="?"+az.reqquery;}var aJ=n(aK,aI.length+1);if(aJ!==""){aI+="&"+aJ;}aI+=Z(aI.length,true);var e='<img src="'+aI+'"/>';an.info("Image tag: "+e);an.log("final url length: "+aI.length);document.write(e);};var ae=function(aJ){var e=az.requrl;if(az.reqquery.length>0){e+="?"+az.reqquery;}var aI=n(aJ,e.length+1);if(aI!==""){e+="&"+aI;}e+=Z(e.length,true);W(e);an.info("Image url: "+e);an.log("final url length: "+e.length);};var Z=function(aM,aR){an.group("Add JS Info");var aS="";var aQ=x();ag=aQ.viewState;an.info("Screen Location Results");an.dir(aQ);var aI="&adsafe_jsinfo=c:"+aC+",sl:"+aQ.viewState+",em:"+Q+",fr:"+l;var aJ=false;if(aS.length+aM+aI.length<=ah){an.info("Adding locInfo.viewState");aS+=aI;aJ=true;}if(aJ){var aL=",pt:"+az.enagementDelay;var e=aQ.viewState!="na"?ax(aQ):"";if(aS.length+aM+e.length+aL.length<=ah){an.info("Adding detailed locInfo");aS+=e+aL;}var aP=",br:"+h.getBrowser();if(aS.length+aM+aP.length<=ah){an.info("Adding SAD param");aS+=aP;}var aO=",id:"+az.asid;if(aS.length+aM+aO.length<=ah){an.info("Adding impression id param");aS+=aO;t=true;}m.iterate(function(aW,aV){var aT,aU=aM+aS.length;aT=","+aW+":";aT+=aV.output();an.pm("AdTalk initial call: "+aV.output());if(aU+aT.length<=ah){aS+=aT;}});if(ak.hasErrors()){an.warn("Errors:",ak,ak.toString());var aN=",e:"+ak.toString();if(aS.length+aM+aN.length<=ah){an.info("Adding error codes");aS+=aN;}}var aK=",v:"+C;if(aS.length+aM+aK.length<=ah){an.info("Adding version param");aS+=aK;}}an.groupEnd();return aS;};var ax=function(aP){var aS="";try{var aK=function(e){if(typeof e!==F&&typeof e.x!==F&&typeof e.y!==F&&typeof e.width!==F&&typeof e.height!==F){return e.x+"."+e.y+"."+e.width+"."+e.height;}return"";};var aO=function(e,aT){return","+e+":"+aT;};var aM=aP.winDimensions;if(typeof aM!=F){try{aS=aO("wc",aK(aM));}catch(aN){throw"wc";}}var aR=aP.adDimensions;if(typeof aR!=F){try{aS+=aO("ac",aK(aR));if(typeof aR.method=="string"){aS+=aO("am",aR.method);}if(typeof aR.container=="object"){aS+=aO("cc",aK(aR.container));}}catch(aN){throw"ad";}}var aL={piv:"percentInView",obst:"obstructed",th:"tabHidden",reas:"reason"};for(var aQ in aL){try{if(aL.hasOwnProperty(aQ)){var aJ=aL[aQ];if(typeof aP[aJ]!==F){aS+=aO(aQ,aP[aJ]);}}}catch(aN){throw aQ;}}}catch(aN){ak.add(ak.codes.LOCATION_DETAILS);var aI=(typeof aN==="string")?aN:(typeof aN.type!=="undefined")?aN.type:"unk";aS+=",detErr:"+aI;an.error(aN);}return aS;};var d=function(aL){var aJ;var aI=aL.length;var e=aL[aI-1];for(aJ=0;aJ<aI;aJ++){var aK=aL[aJ];if(aK.key.indexOf("g")!==-1){e=aK;}}return e;};var W=function(aI){var e=new Image();e.onload=function(){an.info("Image loaded: "+aI);};e.src=aI;};var av=function(){an.groupCollapsed("Checking for kill phrases...");var aQ=false;try{if(typeof az!=F&&typeof az.killPhrases!=F&&az.killPhrases!==""){var aP=az.adsafeSrc;if(aP===""){aP=az.requrl+az.reqquery;}var aM=az.killPhrases.split(",");var aK="";for(var aL=0,aN=aM.length;aL<aN;aL++){var aI=decodeURIComponent(aM[aL]).replace(/^\s+|\s+$/g,"");if(aP.search(aI)!==-1){aK=aI;aQ=true;}}var aJ=(aQ)?'found ("'+aK+'").':"not found.";an.log('Kill phrases ("'+az.killPhrases+'") '+aJ);}else{an.log("Kill phrase empty or not found.");}}catch(aO){ak.add(ak.codes.KILL_IT);an.exception(aO);}an.groupEnd();return aQ;};var S=(typeof JSON!==F&&typeof window.postMessage!==F);var J=function(){var aI={};var aQ=[];if(!S){return;}var aL=[];var aK=function(aT){var aR,aS,aU;aT=aT||az;if(aT.reqquery){aR=aT.reqquery.split("anId=")[1].split("&")[0];}else{aS=aT.adsafeSrc.split("/");aR=aS[5]+"-"+aS[6];}aU={adId:aR,adSafeId:aT.asid};aL.push(aU);return aU;};var aJ=function(){var aS=[];var aR={};var aU={noMe:true};var aV=function(aW){aS.push(aW);aR[aW.pageId]=aW;if(aW.isMe){aU=aW;}};var aT=function(){var aX,aW,a0,aZ,aY=[];for(aX=0;aX<aS.length;aX++){a0=aS[aX];if(a0.isLeaf||a0.isMe||a0.selfDescription!==undefined){aZ="";for(aW=0;aW<a0.position.length;aW++){aZ+=(Number(a0.position[aW])+1).toString(36);}aZ+=(a0.isMe)?"*":"";aZ+=(a0.adProxies.length!==0)?"."+a0.adProxies[0].adId:"";aY.push(aZ);}}return U(aU.unifiedId,62)+"+"+aY.join("|");};return{addFrame:aV,list:aS,lookup:aR,me:function(){return aU;},output:aT};};aJ=new aJ();var aP=function(aU,aT){var aR=aU===window;var aS={position:aT.slice(0),pageId:aT.join("-"),domObj:function(){return aU;},isMe:aR,isLeaf:!aU.frames.length,adProxies:aR?aL:[],selfDescription:undefined,unifiedId:z};aS.toString=function(){return JSON.stringify(aS);};aS.addDescription=function(aV){aS.selfDescription=aV;aS.adProxies=aV.adProxies;};aJ.addFrame(aS);return aS;};var e=function(){var aR=function(aX,aS){var aV=aS.length,aU=aX.frames,aW=new aP(aX,aS);if(!aW.isLeaf){for(var aT=0;aT<aU.length;aT++){aS[aV]=aT;aR(aU[aT],aS);}aS.pop();}};return{start:function(){aR(top,[0]);}};};e=new e();var aM=function(aT){var aS=function(aU,aV){aV=aV||"*";aT.getMessageTime=new Date().getTime();delete aR.updateMessage;delete aR.sendMessage;aU.postMessage(JSON.stringify(aR),aV);};var aR={srcId:az.asid,srcKey:az.asid.split("-")[2],srcStart:g,getMessageTime:undefined,replyTo:document.location,sendMessage:aS,updateMessage:function(aU){aT=aU(aT);},messageContent:aT||{}};return aR;};var aN=function(){var aS=[];var aT=function(){N(window,"message",function(a0){var aW,aZ,aX,aV,aY=aJ.me();try{aW=JSON.parse(a0.data);aZ=aW.messageContent;if(az.asid.split("-")[2]!==aW.srcKey||!aW.hasOwnProperty("messageContent")){return;}if(aZ.unifiedId<aY.unifiedId){aY.unifiedId=aZ.unifiedId;}}catch(a1){return;}aS.push(aW);try{if(aZ.expectedPageId!==aJ.me().pageId){ak.add(ak.codes.ADTALK_DUBIOUS);}else{aV=aJ.lookup[aZ.self.pageId];if(aV===undefined||aV.selfDescription===undefined){aV=aV||new aP(a0.source,aZ.self.pageId.split("-"));aU(aV);}aV.addDescription(aZ.self);}}catch(a1){ak.add(ak.codes.ADTALK_DUBIOUS);}});};var aU=function(aV){var aX=aJ.me();var aW=new aM({self:aX,expectedPageId:aV.pageId,unifiedId:aX.unifiedId});aW.sendMessage(aV.domObj());};var aR=function(){var aW,aV;for(aW=0;aW<aJ.list.length;aW++){aV=aJ.list[aW];if(!aV.isMe){aU(aV);}}};return{sendMessages:aR,listen:aT};};aN=new aN();var aO=function(){var aR=new aK();};return{sendMessages:aN.sendMessages,listen:aN.listen,findFrames:e.start,createAdProxy:function(aS){var aR=new aK(aS);return aR;},getFrameStore:function(){return aJ;}};}();var b=function(aI){switch(az.mode){case"jsli":var e=X(aI);e+=Z(e.length,false);W(e);break;case"jspix":y(aI);break;case"jload":ae(aI);break;default:v(aI);break;}};var q=function(){var aI;if(!av()){if(az.useAdTalk==="true"&&S){try{J.createAdProxy(az);J.findFrames();J.listen();J.sendMessages();m.addItem(J.getFrameStore(),"fm");}catch(aJ){ak.add(ak.codes.ADTALK_GENERAL);}}aw();c.init();at=aj();b(at);if(az.adTalkDtCall==="true"&&S){aI=new Date().getTime();setTimeout(function(){setTimeout(function(){var e={output:new Date().getTime()-aI};m.addItem(e,"sinceFw",{type:a.ADTALK});if(typeof aA!=="undefined"){m.addItem({output:aA},"readyFired",{type:a.ADTALK});}if(r){an.inDoc(J.getFrameStore().output(),2000);}V(null,a.ADTALK);},0);},0);}}};q();az.NS={Output:m};})(adsafeVisParams,new Date().getTime());
